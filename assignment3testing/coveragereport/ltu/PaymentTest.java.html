<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sv"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PaymentTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CodeCoverageReport</a> &gt; <a href="index.source.html" class="el_package">ltu</a> &gt; <span class="el_source">PaymentTest.java</span></div><h1>PaymentTest.java</h1><pre class="source lang-java linenums">package ltu;

import static java.lang.Integer.parseInt;
import static ltu.CalendarFactory.getCalendar;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.time.DayOfWeek;
import java.util.Calendar;
import static org.junit.Assert.*;
import org.junit.Before;
import org.junit.After;
import org.junit.Test;
import java.io.IOException;

<span class="fc" id="L15">public class PaymentTest {</span>
<span class="fc" id="L16">    private final int maxIncomeReq = 85813;</span>
<span class="fc" id="L17">    private final int partTimeStudyRate = 50;</span>
<span class="fc" id="L18">    private final int fullTimeStudyRate = 100;</span>
<span class="fc" id="L19">    private final int fullTimePayoutAmount = 9904;</span>
<span class="fc" id="L20">    private final int partTimePayoutAmount = 4960;</span>
<span class="fc" id="L21">    private final int fullTimeSubsidyAmount = 2816;</span>
<span class="fc" id="L22">    private final int partTimeSubsidyAmount = 1396;</span>
<span class="fc" id="L23">    private final int fullTimeLoanAmount = 7088;</span>
<span class="fc" id="L24">    private final int partTimeLoanAmount = 3564;</span>
<span class="fc" id="L25">    private final int fullCourseCompletion = 100;</span>
<span class="fc" id="L26">    private final int noCourseCompletion = 0;</span>
<span class="fc" id="L27">    private final String AgeBelowReq = &quot;20200615-5441&quot;;</span>
<span class="fc" id="L28">    private final String AgeWithinReq = &quot;20010615-5441&quot;;</span>
<span class="fc" id="L29">    private ICalendar calendar = getCalendar();</span>

    private PaymentImpl payment;

    @Before
    public void setUp() {
        // set up environment before each test
        try {
<span class="fc" id="L37">            payment = new PaymentImpl(calendar);</span>
<span class="nc" id="L38">        } catch (IOException e) {</span>
<span class="nc" id="L39">            e.printStackTrace();</span>
<span class="fc" id="L40">        }</span>
<span class="fc" id="L41">    }</span>

    @After
    public void cleanUp() {
        // clean up after each test
<span class="fc" id="L46">        payment = null;</span>
<span class="fc" id="L47">    }</span>

    @Test
    public void fullTimeStudent_loan() {
        // [ID: 502]
<span class="fc" id="L52">        assertEquals(fullTimeLoanAmount,</span>
<span class="fc" id="L53">                payment.getMonthlyAmount(AgeWithinReq, maxIncomeReq - 1, fullTimeStudyRate,</span>
                        fullCourseCompletion) - fullTimeSubsidyAmount);
<span class="fc" id="L55">    }</span>

    @Test
    public void fullTimeStudent_subsidy() {
        // [ID: 501]
<span class="fc" id="L60">        assertEquals(fullTimeSubsidyAmount,</span>
<span class="fc" id="L61">                payment.getMonthlyAmount(AgeWithinReq, maxIncomeReq - 1, fullTimeStudyRate,</span>
                        fullCourseCompletion) - fullTimeLoanAmount);
<span class="fc" id="L63">    }</span>

    @Test
    public void partTimeStudent_loan() {
        // [ID: 503]
<span class="fc" id="L68">        assertEquals(partTimeLoanAmount,</span>
<span class="fc" id="L69">                payment.getMonthlyAmount(AgeWithinReq, maxIncomeReq - 1, partTimeStudyRate,</span>
                        fullCourseCompletion) - partTimeSubsidyAmount);
<span class="fc" id="L71">    }</span>

    @Test
    public void partTimeStudent_subsidy() {
        // [ID: 504]
<span class="fc" id="L76">        assertEquals(partTimeSubsidyAmount,</span>
<span class="fc" id="L77">                payment.getMonthlyAmount(AgeWithinReq, maxIncomeReq - 1, partTimeStudyRate,</span>
                        fullCourseCompletion) - partTimeLoanAmount);
<span class="fc" id="L79">    }</span>

    @Test
    public void ageTooLow() {
<span class="fc" id="L83">        int result = payment.getMonthlyAmount(AgeBelowReq, maxIncomeReq - 1, fullTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L84">        assertEquals(0, result);</span>
<span class="fc" id="L85">    }</span>

    @Test
    public void incomeTooHigh() {
<span class="fc" id="L89">        int result = payment.getMonthlyAmount(AgeWithinReq, maxIncomeReq + 1, fullTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L90">        assertEquals(0, result);</span>
<span class="fc" id="L91">    }</span>

    @Test
    public void lowCompletion() {
<span class="fc" id="L95">        int result = payment.getMonthlyAmount(AgeWithinReq, maxIncomeReq - 1, fullTimeStudyRate, noCourseCompletion);</span>
<span class="fc" id="L96">        assertEquals(0, result);</span>
<span class="fc" id="L97">    }</span>

    @Test
    public void lastWeekdayOfTheMonth() {
<span class="fc" id="L101">        String paymentDateString = payment.getNextPaymentDay();</span>
<span class="fc" id="L102">        DateTimeFormatter format = DateTimeFormatter.ofPattern(&quot;yyyyMMdd&quot;);</span>
<span class="fc" id="L103">        LocalDate paymentDate = LocalDate.parse(paymentDateString, format);</span>
<span class="fc" id="L104">        DayOfWeek dow = paymentDate.getDayOfWeek();</span>
<span class="pc bpc" id="L105" title="2 of 4 branches missed.">        assertTrue(dow != DayOfWeek.SATURDAY &amp;&amp; dow != DayOfWeek.SUNDAY);</span>
<span class="fc" id="L106">    }</span>

    @Test
    public void ageRequirement_Under20_NotEligible() {
        // [ID: 101] Must be at least 20
<span class="fc" id="L111">        String personId = &quot;20060101-1234&quot;; // 19 years old</span>
<span class="fc" id="L112">        int result = payment.getMonthlyAmount(personId, maxIncomeReq - 1, fullTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L113">        assertEquals(&quot;Student younger than 20 should not receive loan or subsidy&quot;, 0, result);</span>
<span class="fc" id="L114">    }</span>

    @Test
    public void ageRequirement_Exactly20_Eligible() {
        // Boundary: Age at 20
<span class="fc" id="L119">        String personId = &quot;20050101-1234&quot;; // 20 years old</span>
<span class="fc" id="L120">        int result = payment.getMonthlyAmount(personId, maxIncomeReq - 1, fullTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L121">        assertEquals(&quot;20-year-old should receive both loan and subsidy&quot;, fullTimePayoutAmount, result);</span>
<span class="fc" id="L122">    }</span>

    @Test
    public void ageRequirement_At56_EntitledSubsidy() {
        // [ID: 102] No subsidy when they turn 56
<span class="fc" id="L127">        String personId = &quot;19690101-1234&quot;; // 56 years old 1969</span>
<span class="fc" id="L128">        int result = payment.getMonthlyAmount(personId, maxIncomeReq - 1, fullTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L129">        assertEquals(&quot;At 56, only subsidy should be paid&quot;, 2816, result);</span>
<span class="fc" id="L130">    }</span>

    @Test
    public void ageRequirement_above56_NoSubsidy() {
        // Boundary: Above 56 not entitled to subsidy
<span class="fc" id="L135">        String personId = &quot;19680101-1234&quot;; // 57 years old</span>
<span class="fc" id="L136">        int result = payment.getMonthlyAmount(personId, maxIncomeReq - 1, fullTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L137">        assertEquals(&quot;Older than 56 should not receive support&quot;, 0, result);</span>
<span class="fc" id="L138">    }</span>

    @Test
    public void ageRequirement_At47_NoLoanOnlySubsidy() {
        // [ID: 103] No loan from the year they turn 47
<span class="fc" id="L143">        String personId = &quot;19780101-1234&quot;; // 47 years old</span>
<span class="fc" id="L144">        int result = payment.getMonthlyAmount(personId, maxIncomeReq - 1, fullTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L145">        assertEquals(&quot;At 47, only subsidy should be paid&quot;, 2816, result);</span>
<span class="fc" id="L146">    }</span>

    @Test
    public void ageRequirement_At47_LoanOnlySubsidy() {
        // Boundary: Loan still available at 46
<span class="fc" id="L151">        String personId = &quot;19790101-1234&quot;; // 46 years old</span>
<span class="fc" id="L152">        int result = payment.getMonthlyAmount(personId, maxIncomeReq - 1, fullTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L153">        assertEquals(&quot;At 46, both subsidy and loan should be paid&quot;, 9904, result);</span>
<span class="fc" id="L154">    }</span>

    @Test
    public void incomeRequirement_FullTimeAboveLimit_NotEligible() {
        // [ID: 301] Max 85 813 for full time
<span class="fc" id="L159">        String personId = &quot;19900101-1234&quot;; // valid age</span>
<span class="fc" id="L160">        int result = payment.getMonthlyAmount(personId, maxIncomeReq + 1, fullTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L161">        assertEquals(&quot;Full-time student with income &gt; 85 813 should get 0&quot;, 0, result);</span>
<span class="fc" id="L162">    }</span>

    @Test
    public void incomeRequirement_FullTimeAtLimit_Eligible() {
        // Exactly at 85 813
<span class="fc" id="L167">        String personId = &quot;19900101-1234&quot;;</span>
<span class="fc" id="L168">        int result = payment.getMonthlyAmount(personId, maxIncomeReq, fullTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L169">        assertEquals(&quot;Full-time student at income limit should still be eligible&quot;, fullTimePayoutAmount, result);</span>
<span class="fc" id="L170">    }</span>

    @Test
    public void incomeRequirement_PartTimeAboveLimit_NotEligible() {
        // [ID: 302] Max 128 722 for part time
<span class="fc" id="L175">        String personId = &quot;19900101-1234&quot;;</span>
<span class="fc" id="L176">        int result = payment.getMonthlyAmount(personId, 128723, partTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L177">        assertEquals(&quot;Part-time student with income &gt; 128 722 should get 0&quot;, 0, result);</span>
<span class="fc" id="L178">    }</span>

    @Test
    public void incomeRequirement_PartTimeAtLimit_Eligible() {
        // Exactly at 128 722
<span class="fc" id="L183">        String personId = &quot;19900101-1234&quot;;</span>
<span class="fc" id="L184">        int result = payment.getMonthlyAmount(personId, 128722, partTimeStudyRate, fullCourseCompletion);</span>
<span class="fc" id="L185">        assertEquals(&quot;Part-time student at income limit should still be eligible&quot;, partTimePayoutAmount, result);</span>
<span class="fc" id="L186">    }</span>

    // 201
    @Test
    public void lessThanHalfTimeStudyGetsNoSubsidy() throws Exception {
<span class="fc" id="L191">        int studyRate = 25; // less than half-time</span>
<span class="fc" id="L192">        int completionRatio = 100; // valid completion</span>

<span class="fc" id="L194">        int result = payment.getMonthlyAmount(AgeWithinReq, maxIncomeReq - 1, studyRate, completionRatio);</span>
<span class="fc" id="L195">        assertEquals(&quot;Student studying less than half-time should not receive any subsidy&quot;, 0, result);</span>
<span class="fc" id="L196">    }</span>

    // 202
    @Test
    public void halfTimeStudyGetsHalfSubsidy() throws Exception {
<span class="fc" id="L201">        int studyRate = 75; // &lt;100 but &gt;=50 --&gt; half-time</span>
<span class="fc" id="L202">        int completionRatio = 100; // valid completion</span>

<span class="fc" id="L204">        int result = payment.getMonthlyAmount(AgeWithinReq, maxIncomeReq - 1, studyRate, completionRatio);</span>

<span class="fc" id="L206">        int expected = partTimePayoutAmount;</span>
<span class="fc" id="L207">        assertEquals(</span>
                &quot;Student studying less than full time but at least half-time should receive 50% loan + 50% subsidy&quot;,
<span class="fc" id="L209">                expected, result);</span>
<span class="fc" id="L210">    }</span>

    // 203
    @Test
    public void FullTimeStudentGetsFullSubsidy() {
<span class="fc" id="L215">        int completionRatio = fullCourseCompletion; // full time</span>

<span class="fc" id="L217">        int result = payment.getMonthlyAmount(AgeWithinReq, maxIncomeReq - 1, fullTimeStudyRate, completionRatio);</span>

<span class="fc" id="L219">        assertEquals(&quot;Full-time student should receive 100% subsidy&quot;, fullTimePayoutAmount, result);</span>
<span class="fc" id="L220">    }</span>

    // 401
    @Test
    public void CompletionBelow50_NoLoanOrSubsidy() {
<span class="fc" id="L225">        int completionRatio = 40; // less than half-time</span>

<span class="fc" id="L227">        int result = payment.getMonthlyAmount(AgeWithinReq, maxIncomeReq - 1, fullTimeStudyRate, completionRatio);</span>

<span class="fc" id="L229">        assertEquals(&quot;Student with completion ratio &lt; 50% should not receive any loan or subsidy&quot;, 0, result);</span>
<span class="fc" id="L230">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>